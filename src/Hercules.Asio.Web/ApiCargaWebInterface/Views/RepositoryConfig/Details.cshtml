@model ApiCargaWebInterface.ViewModels.RepositoryConfigViewModel

@{
    ViewData["Title"] = Model.Name + " - Repositorio";
    ViewData["BodyClass"] = "fichaRecurso";

    var modeloShape = new ApiCargaWebInterface.ViewModels.ShapeConfigCreateModel();
    var modeloJob = new ApiCargaWebInterface.ViewModels.CreateJobViewModel();
    modeloShape.RepositoryID = Model.RepositoryConfigID;
    modeloJob.IdRepository = Model.RepositoryConfigID;
    string clase = "";
    if (Model.PorcentajeTareas != null)
    {
        if (Model.PorcentajeTareas < 50)
        {
            clase = "class =text-danger";
        }
        else if (50 < Model.PorcentajeTareas && Model.PorcentajeTareas < 70)
        {
            clase = "class =text-warning";
        }
        else
        {
            clase = "class =text-success";
        }
    }
}


<div class="row">
    <div class="col col-12 col-lg-12 col-contenido">
        <div class="wrapCol">
            <div class="header-resource">
                <div class="h1-container">
                    <h1>@Model.Name</h1>
                    <div class="botones">
                        <ul>
                            <li>
                                <a href="#" class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    Publicación manual
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="@Url.Action("Index", "Publish", new {repository = Model.RepositoryConfigID })">Obtención de RDFs</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("ValidarRdf", "Publish", new {repository = Model.RepositoryConfigID })">Validación de RDF</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("PublicarRdf", "Publish", new {repository = Model.RepositoryConfigID })">Publicación de RDF</a>
                                    </li>    
                                </ul>
                            </li>
                            <li>
                                <a href="@Url.Action("Syncro", "Job", new { repositoryId = Model.RepositoryConfigID })" class="btn btn-sincronizar" title="Lanza una tarea de sincronización que actualiza los datos modificados en el reposiotrio desde la fecha de la última ejecución">Sincronizar</a>
                            </li>
                            <li>
                                <a href="@Url.Action("Edit", new {  id=Model.RepositoryConfigID  })" class="btn btn-editar">Editar</a>
                            </li>
                            <li>
                                <a href="@Url.Action("Delete", new {  id=Model.RepositoryConfigID  })" class="btn btn-eliminar">Eliminar</a>
                            </li>
                            <li>
                                <a href="https://github.com/HerculesCRUE/GnossDeustoBackend/blob/master/src/Hercules.Asio.Web/Manual-de-usuario.md#p%C3%A1gina-de-un-repositorio" target="_blank" class="btn btn-documentacion">Documentación</a>
                            </li>
                        </ul>

                    </div>

                </div>
            </div>
            <div class="contenido">
                <div class="grupo grupo-descripcion">
                    <div class="identifier">
                        <p class="titulo">Identificador</p>
                        <p>@Model.RepositoryConfigID</p>
                    </div>
                    @*<div class="outh-token">
                        <p class="titulo">Oauth token</p>
                        <p>@Model.OauthToken</p>
                    </div>*@
                    <div class="outh-token">
                        <p class="titulo">Url</p>
                        <p>@Model.Url</p>
                    </div>
                    <div class="outh-token">
                        <p class="titulo">Tareas de ejecución de sincronización exitosas</p>
                        @if (Model.ListJobs == null || Model.ListJobs.Count == 0)
                        {
                            <p @clase>Aún no se ha ejecutado ninguna tarea</p>
                        }
                        else
                        {
                            <p @clase>@Model.PorcentajeTareas % de las tareas ejecutadas con éxito</p>
                        }
                    </div>
                    <hr />
                    @if (!string.IsNullOrEmpty(Model.LastJob))
                    {
                        <div class="outh-token">
                            <p class="titulo">Última tarea ejecutada</p>
                            <p>@Model.LastJob</p>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.LastState))
                        {
                            <div class="outh-token">
                                <p class="titulo">Estado de la última tarea ejecutada</p>
                                <p>@Model.LastState</p>
                                @if (Model.LastState.Equals("Failed"))
                                {
                                    <a href="@Url.Action("DetailsJob", "Job", new { id = Model.LastJob })">
                                        <p class="text-danger">vea el error</p>
                                    </a>
                                }
                            </div>
                        }
                    }
                    <div class="outh-token">
                        <p class="titulo">Ver las configuraciones de validación para el repositorio</p>
                        <a href="@Url.Action("RepositoryShapes", new {Id = modeloJob.IdRepository })">Validaciones</a>
                    </div>
                    <div>
                        <p class="titulo">Datos de la última sincronización de un set</p>
                        <partial name="_RepositoryConfigSet" model="@Model.RepositoryConfigSet" />
                    </div>
                    <hr />
                </div>
            <div class="grupo grupo-programacion">
                <h2>Tareas de sincronización</h2>
                <a href="@Url.Action("Create", "Job", modeloJob)" class="btn btn-programacion">Crear nueva tarea</a>
                <partial name="_ListRecurringJobs" model="@Model.ListRecurringJobs" />
            </div>
            <div class="grupo grupo-programacion">
                <h2>Tareas programadas</h2>
                @*<a href="@Url.Action("Create", "Job", modeloJob)" class="btn btn-programacion">Crear nueva tarea de sincronización</a>*@
                <partial name="_ListScheduledJobs" model="@Model.ListScheduledJobs" />
            </div>
            @*<div class="grupo grupo-programacion">
                <h2>Shapes</h2>
                <a href="@Url.Action("Create", "ShapeConfig", modeloShape)" class="btn btn-programacion">Crear nuevo Shape</a>
                <partial name="_ListShapes" model="@Model.ShapeConfig" />
            </div>*@
            <div class="grupo grupo-programacion">
                <h2>Ejecuciones completadas</h2>
                @*<a href="@Url.Action("Create", "Job", modeloJob)" class="btn btn-programacion">Crear nueva tarea de sincronización</a>*@
                <partial name="_ListJobs" model="@Model.ListJobs" />
            </div>
        </div>
    </div>
</div>
</div>